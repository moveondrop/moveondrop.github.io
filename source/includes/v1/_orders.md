# Order #

The orders API allows you to manage orders.

## Lifecycle of an Order ##

In general, a MoveOn order can go through three statuses during its lifecycle. These are `pending`, `cancelled` and `delivered`.

Once an order has been placed to MoveOn, for each OrderItem a corresponding BuyOrderItem is created.
An OrderHandler is assigned to this order by MoveOn and a `BuyInvoice` is generated. Once customer
pays the `BuyInvoice`, OrderHandler assigns a buying agent to each of the BuyOrderItem.

Once `BuyingAgent` purchase the item, he sends it to `ShippingAgent` as a ShipmentItem.
After that, `ShippingAgent` ships the ShipmentItem to MoveOn. At this stage, a `ShipmentInvoice`
get generated by MoveOn after calculating its weight/quantity based on `warehouse_category`
that customer chosen during order placement.

MoveOn manages statuses for BuyOrderItem and ShipmentItem separately. Hence, a BuyOrderItem/ShipmentItem
may have a different status from another ByOrderItem in that order.

### Status for an order ###
- **pending**: This indicates that the whole order has not been delivered to the customer yet.
- **canceled**: This indicates that MoveOn has canceled the full order.
- **delivered**: Indicates weather, the full order (All order items) has been delivered to the customer.


### Status for BuyOrderItem ###
- buy-pending: This BuyOrderItem still is in pending state, either customer hasn't paid the `BuyingInvoce` yet or OrderHandler hasn't started working on this item.
- buy-approved: This indicates, `OrderHandler` reviewed this item and assigned a `BuyingAgent` to it for further processing.
- buy-processing: This indicates, `BuyingAgent` started working on this OrderItem.
- buy-reject: Indicates, OrderHandler failed to assign a matching `BuyingAgent` to this OrderItem.
- buy-purchased: Indicates, `BuyingAgent` successfully purchased this BuyOrderItem.
- buy-not-purchased: Indicates, `BuyingAgent` failed to purchase this BuyOrderItem.
- handover-to-shipping: Indicates, `BuyingAgent` successfully handed over this BuyOrderItem to `ShippingAgent`.
- arrived-at-warehouse: Indicates, the BuyOrderItem successfully arrived at `ShippingAgent` warehouse. At this stage, a corresponding `ShipmentItem` is created at MoveOn end
- preparing-for-transport: `ShippingAgent` prepared the `ShipmentItem` for transport.
- handover-to-airline: The `ShipmentItem` is handed over to airline for `Air` shipment if `shipping_type` of chosen warehouse category is `air`.
- arrived-at-destination-airport: The `ShipmentItem` is arrived at destination airport.
- customs-released: The `ShipmentItem` get clearance from customs.
- received-by-moveon: Indicates that, MoveOn received this `ShipmentItem`. Once MoveOn recalculate the weight/quantity for this item, an `ShippingInvoice` get created.

Once the customer paid the `ShippingInvoice`, he can create delivery request for the `ShipmentItem`.

### Available delivery status ###
- delivery-pending:
- delivery-processing:
- delivery-ready:
- delivery-shipped:
- delivered-to-customer:



## Create an order ##

This API helps you to create a new order.

### HTTP request ###

<div class="api-endpoint">
	<div class="endpoint-data">
		<i class="label label-post">POST</i>
		<h6>/customer/buy-ship/orders-by-products</h6>
	</div>
</div>


### Create order properties ###

| Attribute  | Type   | Description      |
|------------|--------|------------------|
| `products` | array  | List of products |
| `address`  | object | address object   |

### Product ###

| Attribute   | Type    | Description                                                 |
|-------------|---------|-------------------------------------------------------------|
| `title`     | string  | Title of the product                                        |
| `vid`       | string  | Vid of the product                                          |
| `link`      | string  | Link of the product                                         |
| `image`     | string  | Primary image of the product                                |
| `vendor`    | string  | Vendor of the product (There is a vendor field inside meta) |
| `store_id`  | integer | Store Id for the product.                                   |
| `aw_cat_id` | integer | Warehouse category id.                                      |
| `metaItems` | array   | List of MetaItem.                                           |                                      |

### MetaItem ###

| Attribute   | Type   | Description                                          |
|-------------|--------|------------------------------------------------------|
| `sku_id`    | string | Sku id of the selected sku.                          ||
| `key`       | string | a random unique id .                                 |
| `price`     | string | Price of the item                                    |
| `qty`       | string | Quantity of the item                                 |
| `meta`      | object | Additional meta object of the selected sku           |

### Address ###

| Attribute             | Type    | Description                          |
|-----------------------|---------|--------------------------------------|
| `billing_address_id`  | integer | Billing address id of the customer.  ||
| `shipping_address_id` | integer | Shipping address id of the customer. ||

> Example of create an order:

```shell
curl -X POST https://moveon-api-server.sbox.ali2bd.net/api/v1/customer/buy-ship/orders-by-products \
	-H "Authorization: Bearer %token%" \
	-H "Content-Type: application/json" \
	-d '{
    "products": [
        {
            "title": "Stainless steel oil spoon PP wheat filter oily oil spoon filtering spoon spoon hot pot leakage germ soup separation spoon",
            "vid": "675196975564",
            "link": "https://detail.1688.com/offer/675196975564.html",
            "image": "https://cbu01.alicdn.com/img/ibank/O1CN01cSNXlq2N9s8Lu1vr8_!!978309921-0-cib.jpg",
            "vendor": "1688",
            "store_id": 10,
            "aw_cat_id": 6402,
            "metaItems": [
                {
                    "sku_id": "c03be97038ed72ea18ec4dc7be132e36",
                    "key": "c03be97038ed72ea18ec4dc7be132e36",
                    "price": 10,
                    "qty": 1,
                    "meta": {
                        "color": "Beige",
                        "size": "medium"
                    }
                }
            ]
        },
        {
            "title": "XIAOMI Mijia Handheld Garment Steamer for Clothes Electric Steam Iron High Quality Portable Traveling Clothes Steamer",
            "vid": "1005002952248539",
            "link": "https://www.aliexpress.com/item/1005002952248539.html",
            "image": "https://ae01.alicdn.com/kf/Hedb73ff2ad254ba3b0d27ae6d6a5a6455/XIAOMI-Mijia-Handheld-Garment-Steamer-for-Clothes-Electric-Steam-Iron-High-Quality-Portable-Traveling-Clothes-Steamer.jpg",
            "vendor": "aliexpress",
            "store_id": 1,
            "aw_cat_id": 6402,
            "metaItems": [
                {
                    "sku_id": "12000026289211983",
                    "key": "12000026289211983",
                    "price": 20,
                    "qty": 1,
                    "meta": {
                        "Ships From": "China",
                        "Plug Type": "US"
                    }
                }
            ]
        }
    ],
    "address": {
        "billing_address_id": 1611,
        "shipping_address_id": 1611
    }
}'
```



## Get orders ##

This API helps you to retrieve the orders.

### HTTP request ###

<div class="api-endpoint">
	<div class="endpoint-data">
		<i class="label label-post">POST</i>
		<h6>/customer/buy-ship/orders/multiple</h6>
	</div>
</div>


### Request ###

### Available query parameters ###

| Attribute | Type  | Description                                 |
|-----------|-------|---------------------------------------------|
| `filters` | array | `['my_order', 'abroad_to_bd', 'bd_to_you']` |



### Response ###

### Orders ###

| Attribute | Type  | Description   |
|-----------|-------|---------------|
| `data`    | array | List of Order |

### Order ###

| Attribute      | Type     | Description                                           |
|----------------|----------|-------------------------------------------------------|
| `id`           | integer  | Id of the order                                       |
| `order_number` | string   | Human readable order number                           |
| `type`         | enum     | Type of this order                                    |
| `created_at`   | datetime | Order placement time                                  |
| `invoices`     | array    | List of `ShippingInvoice` for this order              |
| `buyProducts`  | array    | List of `BuyOrderItem` for this order                 |
| `buyInvoice`   | array    | List of `BuyingInvoice`                               |
| `addresses`    | object   | Contains billing and shipping address of the customer |


> Example of retrieving orders:

```shell
curl -X POST https://moveon-api-server.sbox.ali2bd.net/api/v1/customer/buy-ship/orders/multiple?filters[]=my_order \
	-H "Authorization: Bearer %token%" \
	-H "Content-Type: application/json"
```
